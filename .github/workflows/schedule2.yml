# .github/workflows/schedule2.yml
name: Daily Intelligence & GitHub Report

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.TOEKN_FOREVER_FULL_WRITE }}
    
    - name: Set Shanghai time zone
      run: echo "TZ=Asia/Shanghai" >> $GITHUB_ENV
    
    - name: Install Python dependencies
      run: |
        python -m pip install requests beautifulsoup4
        
    - name: Generate comprehensive daily report
      run: |
        cat > generate_comprehensive_report.py << 'EOF'
        import requests
        import json
        from datetime import datetime
        import random
        import os

        def get_daily_quote():
            """è·å–æ¯æ—¥åè¨€"""
            try:
                quote_response = requests.get('https://api.quotable.io/random')
                quote_data = quote_response.json()
                return f"\"{quote_data['content']}\" â€” {quote_data['author']}"
            except:
                quotes = [
                    "ä»£ç å°±åƒæ˜¯å¹½é»˜â€”â€”ä¸æ˜¯æ¯ä¸ªäººéƒ½æ‡‚ã€‚",
                    "ç¼–ç¨‹æ˜¯å­¦ä¹ å’Œåˆ›é€ çš„è‰ºæœ¯ã€‚",
                    "ä»Šå¤©çš„åŠªåŠ›æ˜¯æ˜å¤©çš„æˆå°±ã€‚",
                    "åšæŒå°±æ˜¯èƒœåˆ©ï¼Œä»£ç äº¦ç„¶ã€‚"
                ]
                return random.choice(quotes)

        def get_weather_info():
            """è·å–å¤©æ°”ä¿¡æ¯"""
            try:
                # ä½¿ç”¨wttr.inçš„APIï¼Œä¸éœ€è¦key
                weather_response = requests.get('http://wttr.in/Shanghai?format=%C+%t+%h+%w', timeout=5)
                if weather_response.status_code == 200:
                    weather_parts = weather_response.text.split()
                    if len(weather_parts) >= 3:
                        return f"{weather_parts[0]}, æ¸©åº¦: {weather_parts[1]}, æ¹¿åº¦: {weather_parts[2]}"
                return "å¤©æ°”ä¿¡æ¯è·å–ä¸­..."
            except:
                weather_conditions = ["æ™´æœ—", "å¤šäº‘", "å°é›¨", "å¾®é£"]
                temperatures = [f"{random.randint(15, 30)}Â°C" for _ in range(5)]
                return f"{random.choice(weather_conditions)}, æ¸©åº¦: {random.choice(temperatures)}"

        def get_github_stats():
            """è·å–GitHubç»Ÿè®¡æ•°æ®"""
            try:
                # è·å–ç”¨æˆ·ä¿¡æ¯
                user_response = requests.get('https://api.github.com/users/Soltus')
                user_data = user_response.json()
                
                # è·å–ä»“åº“ä¿¡æ¯
                repos_response = requests.get('https://api.github.com/users/Soltus/repos?per_page=100')
                repos_data = repos_response.json()
                
                total_stars = sum(repo.get('stargazers_count', 0) for repo in repos_data)
                total_forks = sum(repo.get('forks_count', 0) for repo in repos_data)
                total_watchers = sum(repo.get('watchers_count', 0) for repo in repos_data)
                
                return {
                    'public_repos': user_data.get('public_repos', 'N/A'),
                    'followers': user_data.get('followers', 'N/A'),
                    'following': user_data.get('following', 'N/A'),
                    'total_stars': total_stars,
                    'total_forks': total_forks,
                    'total_watchers': total_watchers
                }
            except Exception as e:
                print(f"GitHub APIé”™è¯¯: {e}")
                return None

        def get_programming_joke():
            """è·å–ç¼–ç¨‹ç¬‘è¯"""
            jokes = [
                "ä¸ºä»€ä¹ˆç¨‹åºå‘˜å–œæ¬¢é»‘æš—æ¨¡å¼ï¼Ÿå› ä¸ºå…‰ä¼šå¸å¼•bugï¼",
                "æˆ‘æœ‰ä¸ªå…³äºStack Overflowçš„ç¬‘è¯ï¼Œä½†å®ƒæ˜¯é‡å¤çš„...",
                "åä¸ªæ ‡å‡†ï¼šæœ‰ï¼Œåœ¨åšäº†ï¼Œå¿«å¥½äº†ï¼Œé©¬ä¸Šï¼Œæ— é™æ¥è¿‘å®Œæˆï¼Œç»å¯¹æ²¡é—®é¢˜",
                "ç¨‹åºå‘˜æœ€è®¨åŒçš„æ•°å­—ï¼š404",
                "æˆ‘å†™ä»£ç çš„æ—¶å€™åªæœ‰ä¸¤ç§çŠ¶æ€ï¼š1. è¿™èƒ½è¡Œ 2. è¿™æ€ä¹ˆèƒ½è¡Œ"
            ]
            return random.choice(jokes)

        def calculate_streak():
            """è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
            try:
                if os.path.exists('æ‰“å¡è®°å½•.md'):
                    with open('æ‰“å¡è®°å½•.md', 'r', encoding='utf-8') as f:
                        content = f.read()
                        return content.count('âœ…')
                return 1
            except:
                return random.randint(1, 30)

        # è·å–æ‰€æœ‰æ•°æ®
        quote = get_daily_quote()
        weather = get_weather_info()
        github_stats = get_github_stats()
        joke = get_programming_joke()
        streak_days = calculate_streak()

        # ç”Ÿæˆç»¼åˆæŠ¥å‘Š
        current_date = datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')
        current_time = datetime.now().strftime('%H:%M:%S')

        report = f"""# ğŸ‰ æ¯æ—¥ç»¼åˆæŠ¥å‘Š - {current_date}

        ## ğŸ“Š æ‰§è¡Œæ‘˜è¦
        - **æŠ¥å‘Šæ—¶é—´**: {current_time}
        - **è¿ç»­æ‰“å¡**: {streak_days} å¤©
        - **ä»Šæ—¥å¿ƒæƒ…**: {random.choice(['ğŸ˜Š æ„‰å¿«', 'ğŸš€ å……æ»¡æ´»åŠ›', 'ğŸ“š å­¦ä¹ æ¨¡å¼', 'ğŸ’¡ åˆ›æ„è¿¸å‘'])}

        ## ğŸŒ¤ï¸ å¤©æ°”ä¿¡æ¯
        {weather}

        ## ğŸ’« ä»Šæ—¥åè¨€
        {quote}

        ## ğŸ‘¨â€ğŸ’» GitHub æ•°æ®ç»Ÿè®¡
        | æŒ‡æ ‡ | æ•°å€¼ |
        |------|------|
        | å…¬å¼€ä»“åº“ | {github_stats['public_repos'] if github_stats else 'N/A'} |
        | ç²‰ä¸æ•° | {github_stats['followers'] if github_stats else 'N/A'} |
        | å…³æ³¨æ•° | {github_stats['following'] if github_stats else 'N/A'} |
        | æ€»æ˜Ÿæ ‡æ•° | {github_stats['total_stars'] if github_stats else 'N/A'} |
        | æ€»Forkæ•° | {github_stats['total_forks'] if github_stats else 'N/A'} |
        | æ€»Watchæ•° | {github_stats['total_watchers'] if github_stats else 'N/A'} |

        ## ğŸ˜„ ç¼–ç¨‹è¶£é—»
        {joke}

        ## ğŸ“ˆ ä»Šæ—¥æ•°æ®é¢æ¿
        - **éšæœºå¹¸è¿æ•°å­—**: {random.randint(1, 100)}
        - **ä»£ç ç”Ÿäº§åŠ›æŒ‡æ•°**: {random.randint(70, 100)}%
        - **ä»Šæ—¥å»ºè®®**: {random.choice(['å¤šå–æ°´', 'ç«™èµ·æ¥æ´»åŠ¨', 'å­¦ä¹ æ–°æŠ€æœ¯', 'å¸®åŠ©ä»–äºº', 'ä»£ç é‡æ„'])}
        - **ç›®æ ‡ä»£ç è¡Œæ•°**: {random.randint(100, 1000)}è¡Œ

        ## ğŸ¯ ä»Šæ—¥æˆå°±
        âœ… {current_time} æ¯æ—¥æ‰“å¡å®Œæˆ  
        âœ… GitHubæ•°æ®ç»Ÿè®¡æ›´æ–°  
        âœ… ç»¼åˆæŠ¥å‘Šç”Ÿæˆ

        ---
        *æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆäº GitHub Actions â€¢ ä¿æŒçƒ­æƒ…ï¼ŒæŒç»­è¿›æ­¥ï¼* 
        """

        # ç¡®ä¿ç›®å½•å­˜åœ¨
        os.makedirs('daily_reports', exist_ok=True)

        # ä¿å­˜æ¯æ—¥æŠ¥å‘Š
        report_filename = f"daily_reports/{datetime.now().strftime('%Y-%m-%d')}.md"
        with open(report_filename, 'w', encoding='utf-8') as f:
            f.write(report)

        # æ›´æ–°æ‰“å¡è®°å½•
        with open('æ‰“å¡è®°å½•.md', 'a', encoding='utf-8') as f:
            f.write(f"- âœ… {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} æ‰“å¡æˆåŠŸ\n")

        # æ›´æ–°README.md
        readme_content = f'''
        # ğŸ‰ Soltusçš„æ™ºèƒ½æ‰“å¡ç³»ç»Ÿ

        ## ğŸ“Š å®æ—¶æ•°æ®
        ![GitHub followers](https://img.shields.io/github/followers/Soltus?style=social)
        ![GitHub User''s stars](https://img.shields.io/github/stars/Soltus?style=social)

        ## ğŸ“… ä»Šæ—¥æŠ¥å‘Š
        ğŸ‘‰ [æŸ¥çœ‹ä»Šæ—¥å®Œæ•´æŠ¥å‘Š]({report_filename})

        ### ğŸ¯ å¿«é€Ÿæ¦‚è§ˆ
        - **æœ€æ–°æ‰“å¡**: {current_time}
        - **è¿ç»­å¤©æ•°**: {streak_days}å¤©
        - **ä»“åº“æ•°é‡**: {github_stats['public_repos'] if github_stats else 'N/A'}ä¸ª
        - **ç²‰ä¸æ•°é‡**: {github_stats['followers'] if github_stats else 'N/A'}äºº

        ## ğŸ“ˆ GitHubç»Ÿè®¡
        | æŒ‡æ ‡ | æ•°å€¼ |
        |------|------|
        | ğŸ“ å…¬å¼€ä»“åº“ | {github_stats['public_repos'] if github_stats else 'N/A'} |
        | â­ æ€»æ˜Ÿæ ‡ | {github_stats['total_stars'] if github_stats else 'N/A'} |
        | ğŸ”„ æ€»Fork | {github_stats['total_forks'] if github_stats else 'N/A'} |
        | ğŸ‘¥ ç²‰ä¸ | {github_stats['followers'] if github_stats else 'N/A'} |

        ## ğŸ—‚ï¸ æŠ¥å‘Šå½’æ¡£
        - [æŸ¥çœ‹æ‰€æœ‰å†å²æŠ¥å‘Š](daily_reports/)

        ## ğŸ¯ é¡¹ç›®ç›®æ ‡
        é€šè¿‡æ¯æ—¥è‡ªåŠ¨åŒ–æäº¤ä¿æŒGitHubè´¡çŒ®å›¾çš„æ´»è·ƒåº¦ï¼ŒåŒæ—¶è®°å½•æˆé•¿è½¨è¿¹ï¼

        ---
        *è‡ªåŠ¨åŒ–ç”Ÿæˆ â€¢ æœ€åæ›´æ–°: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}*
        '''

        with open('README.md', 'w', encoding='utf-8') as f:
            f.write(readme_content)

        print("ç»¼åˆæŠ¥å‘Šç”Ÿæˆå®Œæˆï¼")
        EOF

        python generate_comprehensive_report.py

    - name: Commit and push changes
      run: |
        git config --global user.name "Soltus"
        git config --global user.email "liaoshanyi@qq.com"
        git add .
        git commit -m "ğŸ‰ ç»¼åˆæ—¥æŠ¥ - $(date +%Yå¹´%mæœˆ%dæ—¥)"
        git push https://Soltus:${{ secrets.TOEKN_FOREVER_FULL_WRITE }}@github.com/Soltus/Soltus.git
